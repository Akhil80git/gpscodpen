<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live GPS Location Scanner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 900px;
            overflow: hidden;
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .header h1 {
            color: #1a2980;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #555;
            font-size: 1.1rem;
        }
        
        .gps-status {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            display: none;
        }
        
        .gps-status.active {
            display: block;
        }
        
        .gps-status i {
            color: #1a2980;
            margin-right: 10px;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .setup-section, .verification-section {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            color: #1a2980;
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #26d0ce;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-group input:focus, .input-group select:focus {
            border-color: #26d0ce;
            outline: none;
        }
        
        .unit-selector {
            display: flex;
            margin-top: 10px;
            gap: 15px;
        }
        
        .unit-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .unit-option.selected {
            background-color: #1a2980;
            color: white;
            border-color: #1a2980;
        }
        
        .button {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(26, 41, 128, 0.3);
        }
        
        .button:active {
            transform: translateY(-1px);
        }
        
        .button.secondary {
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }
        
        .button.success {
            background: linear-gradient(to right, #00b09b, #96c93d);
        }
        
        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
        
        .qr-container {
            text-align: center;
            margin-top: 25px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f9f9f9;
            display: none;
        }
        
        .qr-code {
            margin: 20px auto;
            padding: 10px;
            background: white;
            border-radius: 10px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .location-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .location-card {
            flex: 1;
            min-width: 200px;
            background: #f0f8ff;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .location-card h4 {
            color: #1a2980;
            margin-bottom: 10px;
        }
        
        .coordinates {
            font-family: monospace;
            font-size: 14px;
            color: #333;
        }
        
        .distance-info {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .distance-info span {
            font-weight: 600;
            color: #1a2980;
            font-size: 1.2rem;
        }
        
        .live-gps-info {
            background: #e8f4fc;
            border-left: 4px solid #1a2980;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
        }
        
        .live-gps-info h4 {
            color: #1a2980;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .live-gps-info .pulse {
            display: inline-block;
            width: 10px;
            height: 10px;
            background-color: #ff4757;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.95); opacity: 0.7; }
        }
        
        .accuracy-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #777;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .gps-accuracy {
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .gps-accuracy-fill {
            height: 100%;
            background: linear-gradient(to right, #ff4757, #2ed573);
            width: 0%;
            transition: width 1s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-satellite"></i> Live GPS Location Scanner</h1>
            <p>This system uses your phone's LIVE GPS location (not IP-based location) for accurate verification</p>
        </div>
        
        <div id="gpsStatus" class="gps-status">
            <i class="fas fa-satellite-dish"></i>
            <span id="gpsStatusText">GPS is active. Getting your live location...</span>
        </div>
        
        <div class="main-content">
            <div class="setup-section">
                <h2 class="section-title"><i class="fas fa-cogs"></i> Setup Your Home Location</h2>
                
                <div class="location-card">
                    <h4>Your Home Location</h4>
                    <div class="coordinates">
                        <div>Latitude: <span id="homeLatDisplay">24.683258</span></div>
                        <div>Longitude: <span id="homeLngDisplay">80.541967</span></div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="radius">Allowed Radius (in meters)</label>
                    <input type="number" id="radius" value="567">
                    
                    <div class="unit-selector">
                        <div class="unit-option selected" id="unit-meters">Meters</div>
                        <div class="unit-option" id="unit-km">Kilometers</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="accuracyThreshold">GPS Accuracy Threshold (meters)</label>
                    <input type="number" id="accuracyThreshold" value="50">
                    <small>Lower values = more precise but may take longer to get location</small>
                </div>
                
                <button class="button" id="saveLocationBtn">
                    <i class="fas fa-save"></i> Save Settings
                </button>
                
                <button class="button secondary" id="useCurrentLocationBtn">
                    <i class="fas fa-map-marker-alt"></i> Use My Current Location as Home
                </button>
                
                <div id="setupStatus" class="status-message"></div>
            </div>
            
            <div class="verification-section">
                <h2 class="section-title"><i class="fas fa-search-location"></i> Live GPS Verification</h2>
                
                <div class="live-gps-info">
                    <h4><span class="pulse"></span> Live GPS Location</h4>
                    <div class="coordinates">
                        <div>Latitude: <span id="currentLat">--</span></div>
                        <div>Longitude: <span id="currentLng">--</span></div>
                        <div>Accuracy: <span id="currentAccuracy">--</span> meters</div>
                    </div>
                    <div class="gps-accuracy">
                        <div class="gps-accuracy-fill" id="accuracyBar"></div>
                    </div>
                    <div class="accuracy-info">Lower accuracy values are better (more precise)</div>
                </div>
                
                <div class="location-info">
                    <div class="location-card">
                        <h4>Home Location</h4>
                        <div class="coordinates">
                            <div>Lat: 24.683258</div>
                            <div>Lng: 80.541967</div>
                        </div>
                    </div>
                    
                    <div class="location-card">
                        <h4>Your Location</h4>
                        <div class="coordinates">
                            <div>Lat: <span id="displayLat">--</span></div>
                            <div>Lng: <span id="displayLng">--</span></div>
                        </div>
                    </div>
                </div>
                
                <button class="button success" id="startTrackingBtn">
                    <i class="fas fa-play-circle"></i> Start Live GPS Tracking
                </button>
                
                <button class="button" id="stopTrackingBtn">
                    <i class="fas fa-stop-circle"></i> Stop Tracking
                </button>
                
                <div id="verificationStatus" class="status-message"></div>
                
                <div class="distance-info">
                    <label>Distance from Home</label>
                    <span id="distance">--</span> meters
                    <div id="distanceMessage"></div>
                </div>
                
                <div class="qr-container" id="qrContainer">
                    <h3><i class="fas fa-qrcode"></i> Access Granted QR Code</h3>
                    <div class="qr-code" id="qrCode">
                        <!-- QR code will be generated here -->
                    </div>
                    <p>This QR code is only generated when you're within the allowed radius</p>
                    <button class="button" id="downloadQRBtn" style="margin-top: 15px; max-width: 200px;">
                        <i class="fas fa-download"></i> Download QR
                    </button>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p><i class="fas fa-info-circle"></i> This system uses your phone's actual GPS (not IP location). For best results:</p>
            <p>1. Enable GPS/Location on your phone<br>
               2. Go outside or near a window<br>
               3. Allow location access in browser permissions</p>
        </div>
    </div>

    <script>
        // DOM Elements
        const homeLatDisplay = document.getElementById('homeLatDisplay');
        const homeLngDisplay = document.getElementById('homeLngDisplay');
        const radiusInput = document.getElementById('radius');
        const accuracyThresholdInput = document.getElementById('accuracyThreshold');
        const unitMeters = document.getElementById('unit-meters');
        const unitKm = document.getElementById('unit-km');
        const saveLocationBtn = document.getElementById('saveLocationBtn');
        const useCurrentLocationBtn = document.getElementById('useCurrentLocationBtn');
        const setupStatus = document.getElementById('setupStatus');
        const gpsStatus = document.getElementById('gpsStatus');
        const gpsStatusText = document.getElementById('gpsStatusText');
        const startTrackingBtn = document.getElementById('startTrackingBtn');
        const stopTrackingBtn = document.getElementById('stopTrackingBtn');
        const currentLatElement = document.getElementById('currentLat');
        const currentLngElement = document.getElementById('currentLng');
        const currentAccuracyElement = document.getElementById('currentAccuracy');
        const displayLatElement = document.getElementById('displayLat');
        const displayLngElement = document.getElementById('displayLng');
        const accuracyBar = document.getElementById('accuracyBar');
        const verificationStatus = document.getElementById('verificationStatus');
        const distanceElement = document.getElementById('distance');
        const distanceMessage = document.getElementById('distanceMessage');
        const qrContainer = document.getElementById('qrContainer');
        const qrCodeElement = document.getElementById('qrCode');
        const downloadQRBtn = document.getElementById('downloadQRBtn');
        
        // State variables
        let savedLocation = { lat: 24.683258, lng: 80.541967 }; // Default home location
        let savedRadius = 567; // Default radius in meters
        let accuracyThreshold = 50; // Default accuracy threshold
        let currentLocation = null;
        let watchId = null;
        let isTracking = false;
        
        // Set up event listeners for unit selection
        unitMeters.addEventListener('click', () => {
            unitMeters.classList.add('selected');
            unitKm.classList.remove('selected');
        });
        
        unitKm.addEventListener('click', () => {
            unitKm.classList.add('selected');
            unitMeters.classList.remove('selected');
            // Convert radius to km if needed
            if (radiusInput.value) {
                radiusInput.value = (parseFloat(radiusInput.value) / 1000).toFixed(3);
            }
        });
        
        // Save settings
        saveLocationBtn.addEventListener('click', () => {
            const radius = parseFloat(radiusInput.value);
            const accuracy = parseFloat(accuracyThresholdInput.value);
            
            if (isNaN(radius) || radius <= 0) {
                showStatus(setupStatus, 'Please enter a valid radius (positive number).', 'error');
                return;
            }
            
            if (isNaN(accuracy) || accuracy < 1) {
                showStatus(setupStatus, 'Please enter a valid accuracy threshold (at least 1 meter).', 'error');
                return;
            }
            
            // Convert radius to meters if in km
            if (unitKm.classList.contains('selected')) {
                savedRadius = radius * 1000;
            } else {
                savedRadius = radius;
            }
            
            accuracyThreshold = accuracy;
            
            showStatus(setupStatus, `Settings saved! Allowed radius: ${savedRadius} meters. GPS accuracy threshold: ${accuracy} meters.`, 'success');
        });
        
        // Use current location as home
        useCurrentLocationBtn.addEventListener('click', () => {
            showStatus(setupStatus, 'Getting your current location to set as home...', 'info');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        savedLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        homeLatDisplay.textContent = savedLocation.lat.toFixed(6);
                        homeLngDisplay.textContent = savedLocation.lng.toFixed(6);
                        
                        showStatus(setupStatus, `Home location updated to your current location: (${savedLocation.lat.toFixed(6)}, ${savedLocation.lng.toFixed(6)})`, 'success');
                    },
                    error => {
                        showStatus(setupStatus, `Failed to get your location: ${getGeolocationError(error)}`, 'error');
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                showStatus(setupStatus, 'Geolocation is not supported by your browser.', 'error');
            }
        });
        
        // Start live GPS tracking
        startTrackingBtn.addEventListener('click', () => {
            if (isTracking) return;
            
            if (!savedLocation || !savedRadius) {
                showStatus(verificationStatus, 'Please save your home location and radius first.', 'error');
                return;
            }
            
            gpsStatus.classList.add('active');
            gpsStatusText.textContent = 'Getting high-accuracy GPS location...';
            
            if (navigator.geolocation) {
                // Start watching position with high accuracy
                watchId = navigator.geolocation.watchPosition(
                    position => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                        
                        // Update display with current coordinates
                        currentLatElement.textContent = currentLocation.lat.toFixed(6);
                        currentLngElement.textContent = currentLocation.lng.toFixed(6);
                        currentAccuracyElement.textContent = currentLocation.accuracy.toFixed(1);
                        displayLatElement.textContent = currentLocation.lat.toFixed(6);
                        displayLngElement.textContent = currentLocation.lng.toFixed(6);
                        
                        // Update accuracy bar (inverse - lower accuracy number is better)
                        let accuracyPercent = Math.min(100, (currentLocation.accuracy / 100) * 100);
                        accuracyBar.style.width = `${accuracyPercent}%`;
                        
                        // Update GPS status
                        if (currentLocation.accuracy <= accuracyThreshold) {
                            gpsStatusText.textContent = `GPS Active - Good Accuracy: ${currentLocation.accuracy.toFixed(1)}m`;
                            gpsStatus.style.background = '#e8f6ef';
                        } else {
                            gpsStatusText.textContent = `GPS Active - Poor Accuracy: ${currentLocation.accuracy.toFixed(1)}m (needs improvement)`;
                            gpsStatus.style.background = '#fdebd0';
                        }
                        
                        // Calculate distance
                        const distance = calculateDistance(
                            savedLocation.lat, savedLocation.lng,
                            currentLocation.lat, currentLocation.lng
                        );
                        
                        // Display distance
                        distanceElement.textContent = distance.toFixed(2);
                        
                        // Check if within radius
                        if (distance <= savedRadius) {
                            distanceMessage.innerHTML = `<span style="color:green;">✅ You are WITHIN the allowed area!</span>`;
                            if (!qrContainer.style.display || qrContainer.style.display === 'none') {
                                generateQRCode();
                            }
                        } else {
                            distanceMessage.innerHTML = `<span style="color:red;">❌ You are OUTSIDE the allowed area</span>`;
                            qrContainer.style.display = 'none';
                        }
                        
                        // Update verification status
                        if (currentLocation.accuracy <= accuracyThreshold) {
                            if (distance <= savedRadius) {
                                showStatus(verificationStatus, `✅ You are at the correct location! Distance: ${distance.toFixed(2)}m`, 'success');
                            } else {
                                showStatus(verificationStatus, `❌ You are ${distance.toFixed(2)}m away from home (outside allowed radius)`, 'error');
                            }
                        } else {
                            showStatus(verificationStatus, `⚠️ GPS accuracy is low (${currentLocation.accuracy.toFixed(1)}m). Move to open area for better accuracy.`, 'info');
                        }
                    },
                    error => {
                        gpsStatusText.textContent = `GPS Error: ${getGeolocationError(error)}`;
                        gpsStatus.style.background = '#fadbd8';
                        showStatus(verificationStatus, `GPS Error: ${getGeolocationError(error)}`, 'error');
                    },
                    {
                        enableHighAccuracy: true,
                        maximumAge: 0,
                        timeout: 5000
                    }
                );
                
                isTracking = true;
                startTrackingBtn.disabled = true;
                stopTrackingBtn.disabled = false;
                showStatus(verificationStatus, 'Live GPS tracking started. Move around to see updates.', 'info');
                
            } else {
                showStatus(verificationStatus, 'Geolocation is not supported by your browser.', 'error');
            }
        });
        
        // Stop GPS tracking
        stopTrackingBtn.addEventListener('click', () => {
            if (watchId !== null) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
                isTracking = false;
                
                gpsStatus.classList.remove('active');
                startTrackingBtn.disabled = false;
                stopTrackingBtn.disabled = true;
                
                showStatus(verificationStatus, 'Live GPS tracking stopped.', 'info');
            }
        });
        
        // Generate QR code
        function generateQRCode() {
            // Clear previous QR code
            qrCodeElement.innerHTML = '';
            
            // Create data for QR code
            const verificationTime = new Date().toLocaleString();
            const qrData = {
                verified: true,
                timestamp: verificationTime,
                homeLocation: savedLocation,
                currentLocation: currentLocation,
                distance: parseFloat(distanceElement.textContent),
                allowedRadius: savedRadius,
                status: "ACCESS GRANTED"
            };
            
            // Create QR code display
            qrCodeElement.innerHTML = `
                <div style="padding: 20px; text-align: center; min-width: 250px;">
                    <div style="font-size: 60px; color: #00b09b; margin-bottom: 10px;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3 style="color: #00b09b; margin-bottom: 10px;">ACCESS GRANTED</h3>
                    <p style="color: #555; font-size: 14px; margin-bottom: 10px;">
                        <strong>Location Verified</strong><br>
                        ${verificationTime}
                    </p>
                    <div style="background: #e8f6ef; padding: 10px; border-radius: 5px; margin: 10px 0;">
                        <div style="font-size: 12px;">
                            <div>Distance: <strong>${parseFloat(distanceElement.textContent).toFixed(2)}m</strong></div>
                            <div>Allowed Radius: <strong>${savedRadius}m</strong></div>
                        </div>
                    </div>
                    <div style="font-family: monospace; font-size: 10px; color: #666; margin-top: 15px; word-break: break-all;">
                        VERIFIED:${Date.now()}:${savedLocation.lat.toFixed(6)}:${savedLocation.lng.toFixed(6)}
                    </div>
                </div>
            `;
            
            // Show QR container
            qrContainer.style.display = 'block';
        }
        
        // Download QR code
        downloadQRBtn.addEventListener('click', () => {
            // Create a canvas for QR code download
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400;
            canvas.height = 500;
            
            // Fill background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw header
            ctx.fillStyle = '#00b09b';
            ctx.fillRect(0, 0, canvas.width, 80);
            
            ctx.fillStyle = 'white';
            ctx.font = 'bold 22px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ACCESS GRANTED', canvas.width/2, 45);
            
            // Draw check mark
            ctx.fillStyle = '#00b09b';
            ctx.font = '60px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('✓', canvas.width/2, 180);
            
            // Draw QR code box (simulated)
            ctx.fillStyle = '#333';
            ctx.fillRect(canvas.width/2 - 100, 220, 200, 200);
            
            ctx.fillStyle = '#e8f6ef';
            ctx.fillRect(canvas.width/2 - 90, 230, 180, 180);
            
            ctx.fillStyle = '#00b09b';
            ctx.font = '40px Arial';
            ctx.fillText('✓', canvas.width/2, 320);
            
            // Draw info
            ctx.fillStyle = '#333';
            ctx.font = 'bold 16px Arial';
            ctx.fillText('LOCATION VERIFIED', canvas.width/2, 450);
            
            ctx.font = '14px Arial';
            ctx.fillText(`Distance: ${parseFloat(distanceElement.textContent).toFixed(2)}m`, canvas.width/2, 475);
            ctx.fillText(`Time: ${new Date().toLocaleTimeString()}`, canvas.width/2, 495);
            
            // Convert to image and trigger download
            const link = document.createElement('a');
            link.download = 'location-access-qr.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            // Show confirmation
            alert('QR code downloaded successfully!');
        });
        
        // Helper function to show status messages
        function showStatus(element, message, type) {
            element.textContent = message;
            element.className = `status-message ${type}`;
            element.style.display = 'block';
            
            // Auto-hide info messages after 5 seconds
            if (type === 'info') {
                setTimeout(() => {
                    element.style.display = 'none';
                }, 5000);
            }
        }
        
        // Helper function to calculate distance between two coordinates in meters
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;
            
            const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                    Math.cos(φ1) * Math.cos(φ2) *
                    Math.sin(Δλ/2) * Math.sin(Δλ/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            
            return R * c; // Distance in meters
        }
        
        // Helper function to get geolocation error message
        function getGeolocationError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    return "Permission denied. Please enable location access in your browser settings.";
                case error.POSITION_UNAVAILABLE:
                    return "Location information unavailable. Make sure GPS is enabled on your device.";
                case error.TIMEOUT:
                    return "Location request timed out. Try moving to an open area.";
                default:
                    return "An unknown error occurred.";
            }
        }
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            // Set default values
            homeLatDisplay.textContent = savedLocation.lat.toFixed(6);
            homeLngDisplay.textContent = savedLocation.lng.toFixed(6);
            radiusInput.value = savedRadius;
            accuracyThresholdInput.value = accuracyThreshold;
            
            // Disable stop button initially
            stopTrackingBtn.disabled = true;
            
            // Show instructions
            setTimeout(() => {
                showStatus(setupStatus, 'Set your home location and radius, then click "Start Live GPS Tracking"', 'info');
            }, 1000);
        });
    </script>
</body>
</html>
