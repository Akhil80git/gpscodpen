<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced QR Scanner System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- QR Generator -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- QR Scanner -->
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
    background:#020617;
    color:#fff;
    font-family:Arial;
    text-align:center;
    padding:15px;
}
button{
    padding:10px 18px;
    border:none;
    border-radius:8px;
    font-size:15px;
    cursor:pointer;
    margin:5px;
}
.gen{background:#22c55e;}
.scan{background:#3b82f6;}
#qrContainer{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:15px;
    margin-top:20px;
}
.box{
    background:#0f172a;
    padding:12px;
    border-radius:12px;
}
#reader{
    width:300px;
    margin:auto;
}
.result{
    margin-top:15px;
    font-size:16px;
    color:#22c55e;
    word-break:break-all;
}
</style>
</head>

<body>

<h2>ğŸ” QR Generator + Scanner</h2>

<button class="gen" onclick="generateQR()">â• New QR</button>
<button class="scan" onclick="startCamera()">ğŸ“· Camera Scan</button>
<button class="scan" onclick="scanImage()">ğŸ“¤ Upload Scan</button>

<div id="qrContainer"></div>

<div id="reader" style="display:none"></div>
<div class="result" id="scanResult"></div>

<input type="file" id="fileInput" accept="image/*" hidden>

<script>
const FIXED_NUMBER = "38373";

// Generate Unique ID
function uniqueID(){
    return Math.random().toString(36).substring(2,8).toUpperCase();
}

// Generate QR
function generateQR(){
    const data = `${FIXED_NUMBER}-UID-${uniqueID()}`;

    const box = document.createElement("div");
    box.className = "box";

    const div = document.createElement("div");
    box.appendChild(div);

    document.getElementById("qrContainer").prepend(box);

    new QRCode(div,{
        text:data,
        width:150,
        height:150
    });
}

// CAMERA SCAN
function startCamera(){
    document.getElementById("reader").style.display="block";

    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qr => {
            document.getElementById("scanResult").innerText =
            "âœ… Scanned Data: " + qr;
            html5QrCode.stop();
        }
    );
}

// IMAGE UPLOAD SCAN
function scanImage(){
    document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change", e=>{
    const file = e.target.files[0];
    const html5QrCode = new Html5Qrcode("reader");

    html5QrCode.scanFile(file,true)
    .then(qr=>{
        document.getElementById("scanResult").innerText =
        "âœ… Scanned Data: " + qr;
    })
    .catch(()=>{
        alert("QR not detected");
    });
});
</script>

</body>
</html>
